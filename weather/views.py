# NewApp / weather / views.py:
from django.http import HttpResponse, JsonResponse
from django.views.decorators.http import require_GET, require_POST # –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∏ –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ –∑–∞–ø–∏—Ç—É
import asyncio
import time
import httpx # .\env\Scripts\activate, pip install httpx

######################################################################
# —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–æ–¥–∞–Ω–Ω—è (–∑–≤–∏—á–∞–π–Ω—ñ, –±–ª–æ–∫—É—é—á—ñ)

def hello_sync(request):
    """–ü—Ä–æ—Å—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è"""
    return HttpResponse("<h1>–ü—Ä–∏–≤—ñ—Ç! –¶–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –ø–æ–¥–∞–Ω–Ω—è üå§Ô∏è</h1>")


@require_GET # –æ–±–º–µ–∂—É—î —Ü–µ–π –º–∞—Ä—à—Ä—É—Ç –ª–∏—à–µ GET-–∑–∞–ø–∏—Ç–∞–º–∏
def time_sync(request):
    """–ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)"""
    current_time = time.strftime("%H:%M:%S")
    return HttpResponse(f"<h2>–ó–∞—Ä–∞–∑: {current_time}</h2>")


@require_POST # –æ–±–º–µ–∂—É—î —Ü–µ–π –º–∞—Ä—à—Ä—É—Ç –ª–∏—à–µ POST-–∑–∞–ø–∏—Ç–∞–º–∏
def echo_sync(request):
    """–ü–æ–≤–µ—Ä—Ç–∞—î –Ω–∞–∑–∞–¥ —Ç–µ, —â–æ –ø—Ä–∏–π—à–æ–≤ —É POST-–∑–∞–ø–∏—Ç—ñ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)"""
    message = request.POST.get("message", "–Ω—ñ—á–æ–≥–æ –Ω–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ")
    return JsonResponse({"received": message, "method": "sync"})


######################################################################
# a—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–æ–¥–∞–Ω–Ω—è (async def + await)

async def hello_async(request):
    """–ü—Ä–æ—Å—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è"""
    await asyncio.sleep(0.1) # —ñ–º—ñ—Ç–∞—Ü—ñ—è –Ω–µ–≤–µ–ª–∏–∫–æ—ó –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
    return HttpResponse("<h1>–ü—Ä–∏–≤—ñ—Ç –∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–æ–¥–∞–Ω–Ω—è!‚ö°</h1>")


async def fetch_weather_async(request):
    """
    –†–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API.
    –ü–æ–∫–∞–∑—É—î –ø–µ—Ä–µ–≤–∞–≥—É async –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –º–µ—Ä–µ–∂–µ—é.
    """
    async with httpx.AsyncClient() as client:
        try:
            response = await client.get("https://api.open-meteo.com/v1/forecast?latitude=46.48&longitude=30.73&current_weather=true")
            data = response.json()
            temp = data["current_weather"]["temperature"]
            wind = data["current_weather"]["windspeed"]
            return JsonResponse({
                "city": "–û–¥–µ—Å–∞",
                "temperature": temp,
                "wind_speed": wind,
                "fetched_at": time.strftime("%H:%M:%S"),
                "method": "async"
            })
        except Exception as e:
            return JsonResponse({"error": str(e)}, status=500)

##########################################################################################

# –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–æ–¥–∞–Ω–Ω—è (async def) —É Django –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —Ç–∏–ø–æ–≤–∏—Ö –ø—Ä–æ—î–∫—Ç—ñ–≤.

# –∞–ª–µ —î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –¥–µ async –¥–∞—î —Ä–µ–∞–ª—å–Ω—É –ø–µ—Ä–µ–≤–∞–≥—É.

# —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–æ–¥ –±–ª–æ–∫—É—î –ø–æ—Ç—ñ–∫, –ø–æ–∫–∏ —á–µ–∫–∞—î –Ω–∞ —â–æ—Å—å –ø–æ–≤—ñ–ª—å–Ω–µ:
# - –∑–∞–ø–∏—Ç –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ–≥–æ–¥–∞, –ø–ª–∞—Ç—ñ–∂–Ω—ñ —Å–∏—Å—Ç–µ–º–∏, Google Maps)
# - —á–∏—Ç–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∞–±–æ –º–µ—Ä–µ–∂–µ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
# - —Å—Ç—Ä—ñ–º—ñ–Ω–≥ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–∞—Ç, live-–¥–∞—à–±–æ—Ä–¥, –ø–æ–≤—ñ–ª—å–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è CSV)

# —É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ—Å—Ç–æ "—Å–∏–¥–∏—Ç—å —ñ —á–µ–∫–∞—î" ‚Äî —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏ —Å—Ç–æ—è—Ç—å —É —á–µ—Ä–∑—ñ.
# —É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ (–∑ ASGI-—Å–µ—Ä–≤–µ—Ä–æ–º —Ç–∏–ø—É Daphne / Uvicorn):

# –∫–æ–ª–∏ –ø–æ–¥–∞–Ω–Ω—è —Ä–æ–±–∏—Ç—å await (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, await httpx.get(...)), –≤–æ–Ω–æ –≤—ñ–¥–¥–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–∑–∞–¥ —É event loop.
# —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ –≤ —Ü–µ–π –º–æ–º–µ–Ω—Ç –æ–±—Ä–æ–±–ª—è—Ç–∏ —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ (—Å–æ—Ç–Ω—ñ / —Ç–∏—Å—è—á—ñ –∑'—î–¥–Ω–∞–Ω—å –Ω–∞ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ).
# —è–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –±—É–¥–µ –∑–Ω–∞—á–Ω–æ –≤–∏—â–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å (throughput) –ø—Ä–∏ –≤–∏—Å–æ–∫–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑ I/O.

# —Ä–µ–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏:
# - –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ü—ñ–Ω/–≥–æ—Ç–µ–ª—ñ–≤/–∞–≤—ñ–∞–∫–≤–∏—Ç–∫—ñ–≤ ‚Äî –æ–¥–∏–Ω –∑–∞–ø–∏—Ç –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ –∑ 5‚Äì10 –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö API, —ñ async –¥–æ–∑–≤–æ–ª—è—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ —á–µ–∫–∞—Ç–∏ –≤—Å—ñ, –∞ –Ω–µ –ø–æ —á–µ—Ä–∑—ñ.
# - —á–∞—Ç / —Ä–µ–∞–ª-—Ç–∞–π–º –¥–∞—à–±–æ—Ä–¥ / notifications (WebSockets + Channels).
# - —Å–µ—Ä–≤—ñ—Å–∏ –∑ –¥–æ–≤–≥–∏–º–∏ —Å—Ç—Ä—ñ–º—ñ–Ω–≥-–≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤–µ–ª–∏–∫–∏—Ö –∑–≤—ñ—Ç—ñ–≤ –Ω–∞ –ª—å–æ—Ç—É).
# - API, —è–∫—ñ —á–∞—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –∑–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ–±–æ—Ç–∞ –∑ open-meteo –Ω–∞ 39 —Ä—è–¥–∫—É ‚Äî —ñ–¥–µ–∞–ª—å–Ω–∏–π –∫–µ–π—Å).

# –∫–æ–ª–∏ async –ù–ï –¥–∞—î –ø–æ–º—ñ—Ç–Ω–æ—ó –ø–µ—Ä–µ–≤–∞–≥–∏ (–∞–±–æ —Å—Ç–∞–Ω–µ –Ω–∞–≤—ñ—Ç—å –≥—ñ—Ä—à–µ):
# - –±—ñ–ª—å—à—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ ‚Äî —á–∏—Å—Ç–æ CPU-–æ–ø–µ—Ä–∞—Ü—ñ—ó –∞–±–æ —à–≤–∏–¥–∫—ñ ORM-–∑–∞–ø–∏—Ç–∏ (Django ORM –≤—Å–µ —â–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º).
# - –Ω–∏–∑—å–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (< 100‚Äì200 –∑–∞–ø–∏—Ç—ñ–≤/—Å–µ–∫) ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–æ–¥ —á–∞—Å—Ç–æ –≤—ñ–¥–ø—Ä–∞—Ü—å–æ–≤—É—î —à–≤–∏–¥—à–µ.
# - –ø—ñ—Å–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ async –º–æ–∂–Ω–∞ –Ω–µ –ø–æ–±–∞—á–∏—Ç–∏ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ, –±–æ –±—ñ–ª—å—à—ñ—Å—Ç—å —á–∞—Å—É –≤–∏—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π ORM.

################################################################################################################################

# –¥–æ—Ä–µ—á—ñ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–µ—Ä–≤–µ—Ä python manage.py runserver —É Django –Ω–µ —î –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º.
# runserver –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–∞—Ü—é—î –Ω–∞ WSGI-—Ä–µ–∂–∏–º—ñ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ).
# —è–∫—â–æ –∑—Ä–æ–±–∏—Ç–∏ async def –ø–æ–¥–∞–Ω–Ω—è ‚Äî Django –π–æ–≥–æ –∑–∞–ø—É—Å–∫–∞—î –π–æ–≥–æ –≤ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–º—É event loop –Ω–∞ –ø–æ—Ç–æ—Ü—ñ), —Ç–æ–º—É await asyncio.sleep(...) –Ω–µ –ø–æ–≤—ñ—Å–∏—Ç—å –≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä.
# –∞–ª–µ —Å–ø—Ä–∞–≤–∂–Ω—å–æ—ó –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ (–ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –∑–∞–ø–∏—Ç—ñ–≤ –ø—ñ–¥ —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è I/O) –Ω–µ–º–∞—î ‚Äî –±–æ WSGI-—Å–µ—Ä–≤–µ—Ä –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –≤ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ (–∞–±–æ –≤ –ø—É–ª—ñ –ø–æ—Ç–æ–∫—ñ–≤, –∞–ª–µ –Ω–µ async).
# –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ async-–ø–æ–¥–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å, –∞–ª–µ –Ω–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏ –≤–∏—Å–æ–∫–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞–±–æ –±–∞–≥–∞—Ç—å–æ—Ö –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∑–∞–ø–∏—Ç–∞—Ö.
# –ø–µ—Ä–µ–≤–∞–≥–∞ async –ø—Ä–æ—è–≤–ª—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ ASGI-—Å–µ—Ä–≤–µ—Ä–æ–º.

# —â–æ —Ç—Ä–µ–±–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ / –∑–º—ñ–Ω–∏—Ç–∏, —â–æ–± async –ø—Ä–∞—Ü—é–≤–∞–≤ –ø–æ-—Å–ø—Ä–∞–≤–∂–Ω—å–æ–º—É?
# —î –¥–≤–∞ –≥–æ–ª–æ–≤–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç–∏:
# - Daphne (pip install daphne)
# - Uvicorn (—à–≤–∏–¥—à–∏–π, —Å—É—á–∞—Å–Ω—ñ—à–∏–π, pip install uvicorn)